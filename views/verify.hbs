<div class="container">
    <br>
    <h1>Datos de Contacto</h1>
    <form action="/placeorder/" name="placeorder" method="POST">
        <h4>Nombre</h4>
        <input type="text" class="form-control" name="name" id="name" disabled="true" value="{{user.name}}"><br>

        <div class="alert alert-danger" role="alert" style="display: none;" id="enterPhone">
            Ingrese el numero de telefono.
        </div>
        <h4>Número de Teléfono</h4>
        <input type="text" class="responsiveInput" name="phone" id="phone" value="{{user.phone}}" disabled="true" ><br>

        <div class="radioButtons">
            <div class="custom-control custom-radio">
                <input type="radio" id="delivery" name="deliveryRadio" class="custom-control-input" checked="true">
                <label class="custom-control-label" for="delivery">A domicilio</label>
            </div>

            <div class="custom-control custom-radio">
                <input type="radio" id="pickup" name="deliveryRadio" class="custom-control-input">
                <label class="custom-control-label" for="pickup">Recoger en
                    establecimiento</label>
            </div>
        </div>

        <div id="addressBox">
            <h4>Dirección</h4>

            <select class="form-control" name="addresses" id="addresses">
                {{#each addresses}}
                    <option value="{{this.type}}">{{this.typeName}}</option>
                {{/each}}
            </select>

            <br>
            {{#each addresses}}
                <div id="address_{{this.id}}">
                    {{this.description}} <br>
                    {{this.reference}}
                </div>

                <input class="form-control" name="address" id="address" value="{{this.description}} {{this.reference}}" type="hidden"><br>
            {{/each}}

            <br>
        </div>

        <div class="text-right">
            <a onclick="validate();" type="button" class="btn btn-success">Realizar Pedido</a>
        </div>
    </form>
</div>

<script>
    $('input[name="deliveryRadio"]').change(function () {
        var radioValue = $("input[name='deliveryRadio']:checked").attr('id');
        if (radioValue === "delivery") {
            $('#addressBox').fadeIn();
        }
        else {
            $('#addressBox').fadeOut();
        }
    });

    function validate() {
        const delay = 3000;//3seconds
        const addressLength = 10;

        let params = {};
        params.name = $('#name').val();
        params.phone = $('#phone').val();
        params.deliveryType = $("input[name='deliveryRadio']:checked").attr('id');
        if (params.deliveryType === "delivery") {
            params.address = $('#address').val();
        }
        $("input[name='deliveryRadio']").val(params.deliveryType);

        let hasError = false;
        if (!params.name) {
            hasError = true;
            $('#enterName').fadeIn().delay(delay).fadeOut();
        }
        if (!params.phone) {
            hasError = true;
            $('#enterPhone').fadeIn().delay(delay).fadeOut();
        }


        if (params.deliveryType === "delivery") {
            if (!params.address) {
                hasError = true;
                $('#enterAddress').fadeIn().delay(delay).fadeOut();
            }
            else if (params.address.length < addressLength) {
                hasError = true;
                $('#addressValid').fadeIn().delay(delay).fadeOut();
            }

        }
        if (!hasError) {
            $("form[name='placeorder']").submit();
        }
    }
</script>